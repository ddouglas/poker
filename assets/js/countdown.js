"use strict";(()=>{var u=class{constructor({initialValue:t,showHour:o,emitter:r,onComplete:e}){this.isRunning=!1;this.initialValue=t,this.showHour=o,this.emitter=r,this.onComplete=e,this.countdownValue=t,this.interval=null}decrementCountdown(){this.countdownValue--,this.emitter(this.format(this.countdownValue)),this.countdownValue===0&&(this.stop(),this.onComplete())}format(t){let o={hours:Math.floor(t/3600%24),minutes:Math.floor(t/60%60),seconds:Math.floor(t%60)},r=[];if(o.hours>0&&this.showHour){let e="";o.hours<10&&(e="0"),e=`${e}${o.hours}`}if(o.minutes==0)r.push("00");else if(o.minutes>0){let e="";o.minutes<10&&(e="0"),e=`${e}${o.minutes}`,r.push(e)}if(o.seconds==0)r.push("00");else if(o.seconds>0){let e="";o.seconds<10&&(e="0"),e=`${e}${o.seconds}`,r.push(e)}return r.join(":")}start(){if(console.debug("Countdown.start()"),this.interval&&(console.debug("Countdown.start() if this.interval"),this.reset()),this.countdownValue===0){console.error("countdownValue is 0, shutdown down"),this.stop();return}console.debug("Countdown.start() this.interval"),this.interval=setInterval(()=>this.decrementCountdown(),1e3),this.isRunning=!0,console.debug("Countdown.start() done",this.interval)}continue(){this.stop(),this.start()}stop(){console.debug("Countdown.stop() start",this.interval),this.interval&&(console.debug("Countdown.stop() clearInterval"),clearInterval(this.interval)),this.interval=null,this.isRunning=!1,console.debug("Countdown.stop() stop")}toggle(){console.debug("Countdown.toggle() start"),this.isRunning?this.stop():this.start(),console.debug("Countdown.toggle() stop")}getIsRunning(){return this.isRunning}reset(){console.debug("Countdown.reset() start"),this.stop(),this.countdownValue=this.initialValue,console.log("reset :: ",this),console.debug("Countdown.reset() stop")}},a=u;function l(){let n=document.getElementById("timer-container"),t=document.getElementById("timer"),o=document.getElementById("toggle-timer-button"),r=document.getElementById("trigger-next-timer-level");if(!n)return console.error("Failed to fetch timer-container by id"),null;if(!t)return console.error("failed to fetch timer element by id"),null;if(!o)return console.error("failed to fetch toggle-timer-button element by id"),null;let e="";r&&(console.error("failed to fetch trigger-next-timer-level element by id"),e=r.getAttribute("hx-get")||"");let i=t.getAttribute("data-level-duration-sec");return i||(console.error("trigger-next-timer-level element is missing attribute data-level-duration-sec"),i="0"),{timer:t,timerContainer:n,timerToggle:o,nextTimerButton:r,nextLevelURI:e,durationSecStr:i}}var c;function m(){c=new AbortController}m();document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded :: start"),d(),f(),console.log("DOMContentLoaded :: complete")});document.body.addEventListener("countdown::proceed",()=>{console.debug("countdown::proceed :: start"),g(),b(),console.debug("countdown::proceed :: complete")});document.body.addEventListener("countdown::reset",()=>{console.debug("countdown::reset :: start"),g(),console.debug("countdown::reset :: complete")});function g(){p(),c.abort(),m(),d(),f()}function f(){let n=l();if(!n){console.error("failed to fetch elements, unable to register click event on timer toggle");return}let{timerToggle:t}=n;t.addEventListener("click",()=>h(),{signal:c.signal})}var s;function d(){console.debug("initCountdown :: start");let n=l();if(!n)return;let{nextLevelURI:t,durationSecStr:o,timer:r}=n,e=0;o&&(e=parseInt(o)),s=new a({initialValue:e,showHour:e>3600,emitter:i=>{r.innerHTML=i,console.debug(`received emitted value ${i}`)},onComplete:()=>{let i=`${t}?proceed=true`;htmx.ajax("GET",i,htmx.find("#timer-container"))}}),console.debug("initCountdown :: complete")}function h(){if(console.debug("toggleCountdown :: start"),!s){console.error("timerToggleEventClick :: countdown not set");return}let n=l();if(!n){console.error("failed to fetch elements, unable to register click event on timer toggle");return}let{timerToggle:t}=n;s.toggle(),s.getIsRunning()?(htmx.removeClass(t,"fa-circle-play"),htmx.addClass(t,"fa-circle-stop")):(htmx.removeClass(t,"fa-circle-stop"),htmx.addClass(t,"fa-circle-play")),console.debug("toggleCountdown :: complete")}function p(){if(console.debug("stopCountdown :: start"),!s){console.error("failed to stop countdown, countdown is undefined",s);return}s.stop();let n=l();if(!n){console.error("failed to fetch elements, unable to register click event on timer toggle");return}let{timerToggle:t}=n;htmx.removeClass(t,"fa-circle-stop"),htmx.addClass(t,"fa-circle-play"),console.debug("stopCountdown :: complete")}function b(){console.debug("startCountdown :: start");let n=l();if(!n){console.error("failed to fetch elements, unable to register click event on timer toggle");return}let{timerToggle:t}=n;htmx.removeClass(t,"fa-circle-stop"),htmx.addClass(t,"fa-circle-play"),s?.start(),console.debug("startCountdown :: complete")}})();
//# sourceMappingURL=countdown.js.map
