"use strict";(()=>{var d=class{constructor({initialValue:e,showHour:t,emitter:n,onComplete:i}){this.isRunning=!1;this.initialValue=e,this.showHour=t,this.emitter=n,this.onComplete=i,this.countdownValue=e,this.interval=null}decrementCountdown(){this.countdownValue--,this.emitter(this.countdownValue,this.format(this.countdownValue)),this.countdownValue===0&&(this.stop(),this.onComplete())}format(e){let t={hours:Math.floor(e/3600%24),minutes:Math.floor(e/60%60),seconds:Math.floor(e%60)},n=[];if(t.hours>0&&this.showHour){let i="";t.hours<10&&(i="0"),i=`${i}${t.hours}`}if(t.minutes==0)n.push("00");else if(t.minutes>0){let i="";t.minutes<10&&(i="0"),i=`${i}${t.minutes}`,n.push(i)}if(t.seconds==0)n.push("00");else if(t.seconds>0){let i="";t.seconds<10&&(i="0"),i=`${i}${t.seconds}`,n.push(i)}return n.join(":")}start(){if(console.debug("Countdown.start()"),this.interval&&(console.debug("Countdown.start() if this.interval"),this.reset()),this.countdownValue===0){console.error("countdownValue is 0, shutdown down"),this.stop();return}console.debug("Countdown.start() this.interval"),this.interval=setInterval(()=>this.decrementCountdown(),1e3),this.isRunning=!0,console.debug("Countdown.start() done",this.interval)}continue(){this.stop(),this.start()}stop(){console.debug("Countdown.stop() start",this.interval),this.interval&&(console.debug("Countdown.stop() clearInterval"),clearInterval(this.interval)),this.interval=null,this.isRunning=!1,console.debug("Countdown.stop() stop")}toggle(){console.debug("Countdown.toggle() start"),this.isRunning?this.stop():this.start(),console.debug("Countdown.toggle() stop")}getIsRunning(){return this.isRunning}hasCounted(){return this.countdownValue<this.initialValue}reset(){console.debug("Countdown.reset() start"),this.stop(),this.countdownValue=this.initialValue,console.log("reset :: ",this),console.debug("Countdown.reset() stop")}},h=d;function l(){let o=document.getElementById("timer-container"),e=document.getElementById("timer"),t=document.getElementById("toggle-timer-button"),n=document.getElementById("audio-play"),i=document.getElementById("audio-continue"),a=document.getElementById("audio-beep"),s=document.getElementById("trigger-next-timer-level");if(!o)return console.error("failed to fetch timer-container by id"),null;if(!e)return console.error("failed to fetch timer element by id"),null;if(!t)return console.error("failed to fetch toggle-timer-button element by id"),null;let c="";s&&(console.error("failed to fetch trigger-next-timer-level element by id"),c=s.getAttribute("hx-get")||"");let u=e.getAttribute("data-level-duration-sec");return u||(console.error("trigger-next-timer-level element is missing attribute data-level-duration-sec"),u="0"),{timer:e,timerContainer:o,timerToggle:t,nextTimerButton:s,nextLevelURI:c,durationSecStr:u,audioPlay:n,audioContinue:i,audioBeep:a}}var m;function f(){m=new AbortController}f();document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded :: start"),g(),w(),console.log("DOMContentLoaded :: complete")});document.body.addEventListener("countdown::proceed",()=>{console.debug("countdown::proceed :: start"),b(),y(),console.debug("countdown::proceed :: complete")});document.body.addEventListener("countdown::reset",()=>{console.debug("countdown::reset :: start"),b(),console.debug("countdown::reset :: complete")});function b(){v(),m.abort(),f(),g(),w()}function w(){let o=l();if(!o){console.error("failed to fetch elements, unable to register click event on timer toggle");return}let{timerToggle:e}=o;e.addEventListener("click",()=>C(),{signal:m.signal})}var r;function g(){console.debug("initCountdown :: start");let o=l();if(!o)return;let{nextLevelURI:e,durationSecStr:t,timer:n,audioBeep:i}=o,a=0;t&&(a=parseInt(t)),r=new h({initialValue:a,showHour:a>3600,emitter:(s,c)=>{if(n.innerHTML=c,console.debug(`received emitted value ${c}`),s==11){console.log("starting end of level beep");let{audioBeep:u}=o;u||console.error("audio play is undefined :-("),u?.play().then(p=>{console.log("end of level beep is playing")}).catch(p=>{console.error("There was an issue playing audio beep",p)})}},onComplete:()=>{if(e){let s=`${e}?proceed=true`;setTimeout(()=>{console.log("timeout set for 1 second"),htmx.ajax("GET",s,htmx.find("#timer-container"))},1e3)}else htmx.removeClass(n,"timer-large-font"),htmx.addClass(n,"timer-complete-font"),n.innerHTML="Timer Complete"}}),console.debug("initCountdown :: complete")}function C(){if(console.debug("toggleCountdown :: start"),!r){console.error("timerToggleEventClick :: countdown not set");return}let o=l();if(!o){console.error("failed to fetch elements, unable to register click event on timer toggle");return}let{timerToggle:e}=o;if(r.toggle(),!r.getIsRunning())htmx.removeClass(e,"fa-circle-stop"),htmx.addClass(e,"fa-circle-play");else{if(!r.hasCounted()){let{audioPlay:t}=o;t||console.error("audio play is undefined :-("),t?.play().then(n=>{console.log("audio is playing")}).catch(n=>{console.error("There was an issue playing audio play",n)})}htmx.removeClass(e,"fa-circle-play"),htmx.addClass(e,"fa-circle-stop")}console.debug("toggleCountdown :: complete")}function v(){if(console.debug("stopCountdown :: start"),!r){console.error("failed to stop countdown, countdown is undefined",r);return}r.stop();let o=l();if(!o){console.error("failed to fetch elements, unable to register click event on timer toggle");return}let{timerToggle:e}=o;htmx.removeClass(e,"fa-circle-stop"),htmx.addClass(e,"fa-circle-play"),console.debug("stopCountdown :: complete")}function y(){console.debug("startCountdown :: start");let o=l();if(!o){console.error("failed to fetch elements, unable to register click event on timer toggle");return}let{timerToggle:e,audioContinue:t}=o;t?.play().then(n=>{console.log("audio is playing")}).catch(n=>{console.error("There was an issue playing audio continue",n)}),htmx.removeClass(e,"fa-circle-stop"),htmx.addClass(e,"fa-circle-play"),r?.start(),console.debug("startCountdown :: complete")}})();
//# sourceMappingURL=countdown.js.map
